#!/bin/bash

if ! command -v mbedtls &> /dev/null
then
    echo "mbedtls not found. Installing..."

    (
        install_mbedtls_debian() {
            sudo apt update
            sudo apt install mbedtls
            mbedtls --version
        }

        install_mbedtls_fedora() {
            sudo dnf install mbedtls
            sudo dnf upgrade mbedtls
        }

        install_mbedtls_macos() {
            if command -v brew &> /dev/null; then
                echo "Homebrew found, installing mbedtls..."
                HOMEBREW_NO_AUTO_UPDATE=1 brew install mbedtls
            else
                echo "Homebrew not found; install mbedtls manually on macOS."
            fi
        }

        OS=$(uname -s)

            case "$OS" in
                Linux)
                    . /etc/os-release
                    if [ "$ID" = "ubuntu" ] || [ "$ID_LIKE" = "debian" ]; then
                        install_mbedtls_debian
                    elif [ "$ID" = "fedora" ]; then
                        install_mbedtls_fedora
                    else
                        echo "Unsupported Linux distribution"
                    fi
                    ;;
                Darwin)
                    install_mbedtls_macos
                    ;;
                *)
                    echo "Unsupported operating system. Please install mbedtls manually."
                    ;;
            esac
    )
    if command -v mbedtls &> /dev/null; then
        echo "mbedtls installed."
    fi
else
    echo "mbedtls found."
fi

if ! command -v ffmpeg &> /dev/null
then
    echo "ffmpeg not found. Installing..."

    (
        install_ffmpeg_debian() {
            sudo apt update
            sudo apt install ffmpeg
            ffmpeg -version
        }

        install_ffmpeg_fedora() {
            sudo dnf install ffmpeg
            sudo dnf upgrade ffmpeg
        }

        install_ffmpeg_macos() {
            if command -v brew &> /dev/null; then
                echo "Homebrew found, installing ffmpeg..."
                HOMEBREW_NO_AUTO_UPDATE=1 brew install ffmpeg
            else
                echo "Homebrew not found, downloading ffmpeg binaries..."
                curl -L https://evermeet.cx/ffmpeg/ffmpeg-6.1.zip -o ffmpeg-6.1.zip
                unzip ffmpeg-6.1.zip
                sudo mv ffmpeg-6.1 /usr/local/bin/ffmpeg
            fi
        }

        OS=$(uname -s)

            case "$OS" in
                Linux)
                    . /etc/os-release
                    if [ "$ID" = "ubuntu" ] || [ "$ID_LIKE" = "debian" ]; then
                        install_ffmpeg_debian
                    elif [ "$ID" = "fedora" ]; then
                        install_ffmpeg_fedora
                    else
                        echo "Unsupported Linux distribution"
                    fi
                    ;;
                Darwin)
                    install_ffmpeg_macos
                    ;;
                *)
                    echo "Unsupported operating system. Please install ffmpeg manually."
                    ;;
            esac
    )

    if command -v ffmpeg &> /dev/null
    then
        echo "ffmpeg installed."
    fi
else
    echo "ffmpeg found."
fi
